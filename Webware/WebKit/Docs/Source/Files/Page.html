<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>WebKit/Page.py</title>
<!--css-->

<style type="text/css">
<!--
body{ background: #EEF;
font-family: Verdana, Arial, Helvetica, sans-serif;
font-size: 10pt;
padding: 3pt; }
.PY_KEYWORD{ color: #00C; font-weight: bold; }
.PY_COMMENT{ color: #008; }
.PY_PARAMETER{ color: #C00; }
.PY_IDENTIFIER{ color: #C00; font-weight: bold; }
.PY_STRING{ color: #080; }
-->
</style>
</head>
<body>
<!--header-->

<!--script-->
<pre><span class="PY_STRING">"""The standard web page template."""</span>

<span class="PY_KEYWORD">from</span> WebUtils <span class="PY_KEYWORD">import</span> Funcs
<span class="PY_KEYWORD">from</span> HTTPContent <span class="PY_KEYWORD">import</span> HTTPContent


<span class="PY_KEYWORD">class</span> Page(HTTPContent):
    <span class="PY_STRING">"""The standard web page template.

    Page is a type of HTTPContent that is more convenient for servlets
    which represent HTML pages generated in response to GET and POST requests.
    In fact, this is the most common type of Servlet.

    Subclasses typically override `writeHeader`, `writeBody` and `writeFooter`.

    They might also choose to override `writeHTML` entirely.

    When developing a full-blown website, it's common to create a subclass of
    `Page` called `SitePage` which defines the common look and feel of the
    website and provides site-specific convenience methods. Then all other
    pages in your application then inherit from `SitePage`.

    """</span>


    <span class="PY_COMMENT">## Transactions ##</span>

    <span class="PY_KEYWORD">def</span> defaultAction(self):
        <span class="PY_STRING">"""The default action in a Page is to writeHTML()."""</span>
        self.writeHTML()


    <span class="PY_COMMENT">## Generating results ##</span>

    <span class="PY_KEYWORD">def</span> title(self):
        <span class="PY_STRING">"""The page title.

        Subclasses often override this method to provide a custom title.
        This title should be absent of HTML tags. This implementation
        returns the name of the class, which is sometimes appropriate
        and at least informative.

        """</span>
        <span class="PY_KEYWORD">return</span> self.__class__.__name__

    <span class="PY_KEYWORD">def</span> htTitle(self):
        <span class="PY_STRING">"""The page title as HTML.

        Return self.title(). Subclasses sometimes override this to provide
        an HTML enhanced version of the title. This is the method that should
        be used when including the page title in the actual page contents.

        """</span>
        <span class="PY_KEYWORD">return</span> self.title()

    <span class="PY_KEYWORD">def</span> htBodyArgs(self):
        <span class="PY_STRING">"""The atrributes for the &lt;body&gt; element.

        Returns the arguments used for the HTML &lt;body&gt; tag.
        Invoked by writeBody().

        With the prevalence of stylesheets (CSS), you can probably skip
        this particular HTML feature, but for historical reasons this sets
        the page to black text on white.

        """</span>
        <span class="PY_KEYWORD">return</span> <span class="PY_STRING">'text="black" bgcolor="white"'</span>

    <span class="PY_KEYWORD">def</span> writeHTML(self):
        <span class="PY_STRING">"""Write all the HTML for the page.

        Subclasses may override this method (which is invoked by `_respond`)
        or more commonly its constituent methods, `writeDocType`, `writeHead`
        and `writeBody`.

        You will want to override this method if:
          * you want to format the entire HTML page yourself
          * if you want to send an HTML page that has already been generated
          * if you want to use a template that generates the entire page
          * if you want to send non-HTML content; in this case, be sure to call
            self.response().setHeader('Content-Type', 'mime/type').

        """</span>
        self.writeDocType()
        self.writeln(<span class="PY_STRING">'&lt;html&gt;'</span>)
        self.writeHead()
        self.writeBody()
        self.writeln(<span class="PY_STRING">'&lt;/html&gt;'</span>)

    <span class="PY_KEYWORD">def</span> writeDocType(self):
        <span class="PY_STRING">"""Write the DOCTYPE tag.

        Invoked by `writeHTML` to write the ``&lt;!DOCTYPE ...&gt;`` tag.

        By default this gives the HTML 4.01 Transitional DOCTYPE,
        which is a good guess for what most people send.  Be
        warned, though, that some browsers render HTML differently
        based on the DOCTYPE (particular newer browsers, like
        Mozilla, do this).

        Subclasses may override to specify something else.

        You can find out more about doc types by searching for
        DOCTYPE on the web, or visiting:
        http://www.htmlhelp.com/tools/validator/doctype.html

        """</span>
        self.writeln(<span class="PY_STRING">'&lt;!DOCTYPE HTML PUBLIC'</span>
            <span class="PY_STRING">' "-//W3C//DTD HTML 4.01 Transitional//EN"'</span>
            <span class="PY_STRING">' "http://www.w3.org/TR/html4/loose.dtd"&gt;'</span>)

    <span class="PY_KEYWORD">def</span> writeHead(self):
        <span class="PY_STRING">"""Write the &lt;head&gt; element of the page.

        Writes the ``&lt;head&gt;`` portion of the page by writing the
        ``&lt;head&gt;...&lt;/head&gt;`` tags and invoking `writeHeadParts` in between.

        """</span>
        wr = self.writeln
        wr(<span class="PY_STRING">'&lt;head&gt;'</span>)
        self.writeHeadParts()
        wr(<span class="PY_STRING">'&lt;/head&gt;'</span>)

    <span class="PY_KEYWORD">def</span> writeHeadParts(self):
        <span class="PY_STRING">"""Write the parts included in the &lt;head&gt; element.

        Writes the parts inside the ``&lt;head&gt;...&lt;/head&gt;`` tags.
        Invokes `writeTitle` and then `writeMetaData`, `writeStyleSheet`
        and `writeJavaScript`. Subclasses should override the `title`
        method and the three latter methods only.

        """</span>
        self.writeTitle()
        self.writeMetaData()
        self.writeStyleSheet()
        self.writeJavaScript()

    <span class="PY_KEYWORD">def</span> writeTitle(self):
        <span class="PY_STRING">"""Write the &lt;title&gt; element of the page.

        Writes the ``&lt;title&gt;`` portion of the page.
        Uses `title`, which is where you should override.

        """</span>
        self.writeln(<span class="PY_STRING">'\t&lt;title&gt;%s&lt;/title&gt;'</span> % self.title())

    <span class="PY_KEYWORD">def</span> writeMetaData(self):
        <span class="PY_STRING">"""Write the meta data for the page.

        This default implementation does nothing.
        Subclasses should override if necessary.

        A typical implementation is:

            self.writeln('\t&lt;meta http-equiv="content-type" content="text/html; charset=ISO-8859-1"&gt;')

        """</span>
        <span class="PY_KEYWORD">pass</span>

    <span class="PY_KEYWORD">def</span> writeStyleSheet(self):
        <span class="PY_STRING">"""Write the CSS for the page.

        This default implementation does nothing.
        Subclasses should override if necessary.

        A typical implementation is:

            self.writeln('\t&lt;link rel="stylesheet" href="StyleSheet.css" type="text/css"&gt;')

        """</span>
        <span class="PY_KEYWORD">pass</span>

    <span class="PY_KEYWORD">def</span> writeJavaScript(self):
        <span class="PY_STRING">"""Write the JavaScript for the page.

        This default implementation does nothing.
        Subclasses should override if necessary.

        A typical implementation is:

            self.writeln('\t&lt;script type="text/javascript" src="ajax.js"&gt;&lt;/script&gt;')

        """</span>
        <span class="PY_KEYWORD">pass</span>

    <span class="PY_KEYWORD">def</span> writeBody(self):
        <span class="PY_STRING">"""Write the &lt;body&gt; element of the page.

        Writes the ``&lt;body&gt;`` portion of the page by writing the
        ``&lt;body&gt;...&lt;/body&gt;`` (making use of `htBodyArgs`) and
        invoking `writeBodyParts` in between.

        """</span>
        wr = self.writeln
        bodyArgs = self.htBodyArgs()
        <span class="PY_KEYWORD">if</span> bodyArgs:
            wr(<span class="PY_STRING">'&lt;body %s&gt;'</span> % bodyArgs)
        <span class="PY_KEYWORD">else</span>:
            wr(<span class="PY_STRING">'&lt;body&gt;'</span>)
        self.writeBodyParts()
        wr(<span class="PY_STRING">'&lt;/body&gt;'</span>)

    <span class="PY_KEYWORD">def</span> writeBodyParts(self):
        <span class="PY_STRING">"""Write the parts included in the &lt;body&gt; element.

        Invokes `writeContent`. Subclasses should only override this method
        to provide additional page parts such as a header, sidebar and footer,
        that a subclass doesn't normally have to worry about writing.

        For writing page-specific content, subclasses should override
        `writeContent`() instead. This method is intended to be overridden
        by your SitePage.

        See `SidebarPage` for an example override of this method.

        Invoked by `writeBody`.

        """</span>
        self.writeContent()

    <span class="PY_KEYWORD">def</span> writeContent(self):
        <span class="PY_STRING">"""Write the unique, central content for the page.

        Subclasses should override this method (not invoking super) to write
        their unique page content.

        Invoked by `writeBodyParts`.

        """</span>
        self.writeln(<span class="PY_STRING">'&lt;p&gt; This page has not yet customized its content. &lt;/p&gt;'</span>)

    <span class="PY_KEYWORD">def</span> preAction(self, actionName):
        <span class="PY_STRING">"""Things to do before actions.

        For a page, we first writeDocType(), &lt;html&gt;, and then writeHead().

        """</span>
        self.writeDocType()
        self.writeln(<span class="PY_STRING">'&lt;html&gt;'</span>)
        self.writeHead()

    <span class="PY_KEYWORD">def</span> postAction(self, actionName):
        <span class="PY_STRING">"""Things to do after actions.

        Simply close the html tag (&lt;/html&gt;).

        """</span>
        self.writeln(<span class="PY_STRING">'&lt;/html&gt;'</span>)


    <span class="PY_COMMENT">## Convenience Methods ##</span>

    @staticmethod
    <span class="PY_KEYWORD">def</span> htmlEncode(s):
        <span class="PY_STRING">"""HTML encode special characters.
        Alias for `WebUtils.Funcs.htmlEncode`, quotes the special characters
        &amp;, &lt;, &gt;, and \"

        """</span>
        <span class="PY_KEYWORD">return</span> Funcs.htmlEncode(s)

    @staticmethod
    <span class="PY_KEYWORD">def</span> htmlDecode(s):
        <span class="PY_STRING">"""HTML decode special characters.

        Alias for `WebUtils.Funcs.htmlDecode`. Decodes HTML entities.

        """</span>
        <span class="PY_KEYWORD">return</span> Funcs.htmlDecode(s)


    <span class="PY_COMMENT">## Validate HTML output (developer debugging) ##</span>

    <span class="PY_KEYWORD">def</span> validateHTML(self, closingTags=<span class="PY_STRING">'&lt;/body&gt;&lt;/html&gt;'</span>):
        <span class="PY_STRING">"""Validate the response.

        Validate the current response data using Web Design Group's
        HTML validator available at
        http://www.htmlhelp.com/tools/validator/

        Make sure you install the offline validator (called
        ``validate``) which can be called from the command-line.
        The ``validate`` script must be in your path.

        Add this method to your SitePage (the servlet from
        which all your servlets inherit), override
        Page.writeBodyParts() in your SitePage like so::

            def writeBodyParts(self):
                Page.writeBodyParts()
                self.validateHTML()

        The ``closingtags`` param is a string which is appended
        to the page before validation.  Typically, it would be
        the string ``&lt;/body&gt;&lt;/html&gt;``.  At the point this method
        is called (e.g. from `writeBodyParts`) the page is not
        yet 100% complete, so we have to fake it.

        """</span>
        <span class="PY_COMMENT"># don't bother validating if the servlet has redirected</span>
        status = self.response().header(<span class="PY_STRING">'status'</span>, None)
        <span class="PY_KEYWORD">if</span> status <span class="PY_KEYWORD">and</span> <span class="PY_STRING">'Redirect'</span> <span class="PY_KEYWORD">in</span> status:
            <span class="PY_KEYWORD">return</span>
        response = self.response().rawResponse()
        contents = response[<span class="PY_STRING">'contents'</span>] + closingTags
        <span class="PY_KEYWORD">from</span> WebUtils <span class="PY_KEYWORD">import</span> WDGValidator
        errorText = WDGValidator.validateHTML(contents)
        <span class="PY_KEYWORD">if</span> <span class="PY_KEYWORD">not</span> errorText:
            <span class="PY_KEYWORD">return</span>
        self.write(errorText)
</pre>
<!--footer-->

</body>
</html>
