<html>

<head>
	<link rel=STYLESHEET href="StyleSheet.css" type="text/css">
	<style type="text/css">
	<!--
		.OSLink		{	font-family: Arial, Helvetica;
						font-size: 18pt;
						font-weight: bold;
						color: white;
					}
		code		{	color: darkblue;
						font-weight: bold;
					}
	-->
	</style>
	<title>WebKit Install Guide</title>
</head>


<body>

<h1>WebKit Install Guide</h1>
WebKit 0.6.1
<br>Webware for Python 0.6.1


<a name=TOC><h2>Table of Contents</h2></a>

<p><span class=ToC>
     <a href="#Introduction"><font size=+1>Introduction</font></a>
<br> <a href="#Python"><font size=+1>Python</font></a>
<br> <a href="#WebwareVersion"><font size=+1>Webware Version</font></a>
<br> <a href="#InstallingWebware"><font size=+1>Installing Webware</font></a>
<br> <a href="#OpSys"><font size=+1>Operating Systems</font></a>
<br> <a href="#WebServers"><font size=+1>Web Servers</font></a>
<br> &nbsp; &nbsp; &nbsp; <a href="#WebServers_Apache">Apache</a>
<br> &nbsp; &nbsp; &nbsp; <a href="#WebServers_IIS">IIS</a>
<br> &nbsp; &nbsp; &nbsp; <a href="#WebServers_AOLserver">AOLserver</a>
<br> <a href="#Architecture"><font size=+1>Architecture</font></a>
<br> <a href="#BadMarshalData"><font size=+1>Bad Marshal Data</font></a>
<br> <a href="#Adapters"><font size=+1>Adapters</font></a>
<br> &nbsp; &nbsp; &nbsp; <a href="#Adapters_Permissions">Permissions</a>
<br> &nbsp; &nbsp; &nbsp; <a href="#Adapters_CGI">CGI Adapter</a>
<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#None">1. Review and fix permissions</a>
<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#None">2. Set up WebKit.cgi</a>
<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#None">3. Launch the servers</a>
<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#None">4. Try it out</a>
<br> &nbsp; &nbsp; &nbsp; <a href="#Adapters_Stopping">Stopping the App Server</a>
<br> &nbsp; &nbsp; &nbsp; <a href="#Adapters_Reloading">Reloading Servlets</a>
<br> &nbsp; &nbsp; &nbsp; <a href="#Adapters_OneShot">OneShot Adapter</a>
<br> &nbsp; &nbsp; &nbsp; <a href="#Adapters_FastCGI">FastCGI Adapter</a>
<br> &nbsp; &nbsp; &nbsp; <a href="#Adapters_mod_python">Mod_python Adapter</a>
<br> &nbsp; &nbsp; &nbsp; <a href="#Adapters_mod_snake">ModSnake Adapter</a>
<br> &nbsp; &nbsp; &nbsp; <a href="#Adapters_mod_webkit">ModWebkit Adapter</a>
<br> &nbsp; &nbsp; &nbsp; <a href="#Adapters_AOLserver">AOLserver Adapter</a>
<br> &nbsp; &nbsp; &nbsp; <a href="#Adapters_Renaming">Renaming Adapters</a>
<br> <a href="#Configuration"><font size=+1>Configuration</font></a>
<br> &nbsp; &nbsp; &nbsp; <a href="#Configuration_Sessions">Sessions</a>
<br> &nbsp; &nbsp; &nbsp; <a href="#Configuration_ActivityLog">Activity Log</a>
<br> &nbsp; &nbsp; &nbsp; <a href="#Configuration_EmailErrors">E-mail Errors</a>
<br> <a href="#Contexts"><font size=+1>Contexts</font></a>
<br> <a href="#AppServerNotes"><font size=+1>AppServer Notes</font></a>
<br> &nbsp; &nbsp; &nbsp; <a href="#AppServerNotes_Threaded">ThreadedAppServer</a>
<br> &nbsp; &nbsp; &nbsp; <a href="#AppServerNotes_Monitoring">Monitoring</a>
<br> &nbsp; &nbsp; &nbsp; <a href="#AppServerNotes_UNIXStartUp">Launching the AppServer at UNIX boot up</a>
<br> &nbsp; &nbsp; &nbsp; <a href="#AppServerNotes_NTService">Running ThreadedAppServer as a Windows NT/2000 Service</a>
<br> &nbsp; &nbsp; &nbsp; <a href="#AppServerNotes_Other">Other Notes</a>
<br> <a href="#Future"><font size=+1>Future</font></a>
<br> <a href="#Credit"><font size=+1>Credit</font></a>
</span>


<a name=Introduction><h2>Introduction</h2></a>

<p> WebKit provides an application server that runs on both UNIX and Windows in "CGI-" or "persistent-" mode, with several configuration options to change its behavior.

<p> This install guide takes you through the installation process while showing you what options are available and how you would use them. There are notes for specific operating systems and web servers preceded with tags such as [UNIX], [WinNT], [IIS], etc.

<p> WebKit is pretty easy to install, but there are some important things to know. You will be doing yourself a favor by reading through this guide from top to bottom (skipping sections that don't apply to you).

<p> We recommend that you get a very simple configuration working first, focusing most on a convenient environment for your development. After that, if you still want to play with more advanced setups, then go for it.

<p> The term <i>deploy</i> means to install your web application/site in a well known location for access by your users. You first <i>develop</i> your web application and then <i>deploy</i> it. You will see deployment specific notes throughout the guide since the issues for these two situations can be different. In a nutshell, you want convenience during development, and security and performance during deployment.

<p> You can always e-mail <a href=mailto:webware-discuss@lists.sourceforge.net>webware-discuss@lists.sourceforge.net</a> to give feedback, discuss features and get help using WebKit.


<!--
<h2>Quick Start</h2>
<p>If you would like to jump right in and see WebKit in action, here's what you can do.  WebKit comes with a lightweight Webserver, called AsyncThreadedHTTPServer.  Don't let the name frighten you.  To see WebKit in action without having to set up a webserver and do other configuration, do this:
<p>At a command prompt, do this:

<p><code>cd (path/to/WebWare/WebKit)</code>
<p><code>python Launch.py AsyncThreadedHTTPServer</code>

<p>This will start the sample webserver provided with WebKit.
<p>Now, in your browser, type <code>http://localhost:8086</code>
<p>Hopefully, you'll be looking at WebKit!
<p> To stop the server, switch back to the terminal you started the webserver from, and press control-c.
-->


<a name=Python><h2>Python</h2></a>

<p> WebKit 0.6.1 was tested with Python 1.5.2, 2.0 and 2.1.1. If you have any problems whatsoever with Python 1.5.2 and up, please let us know so we can fix them (<a href=mailto:webware-discuss@lists.sourceforge.net>webware-discuss@lists.sourceforge.net</a>).

<p> Your installation of Python must be multi-threaded, even if you are using the OneShot adapter (which logically doesn't require threads). It's not uncommon for third party web host providers to leave this disabled in Python because they don't expect that it's needed and/or because the default installation of Python does not turn threads on. If your Python installation is not multi-threaded, you will have to reinstall it. If you're using a third party host provider in this situation, you may be able to install it yourself into your home directory via a telnet or ssh account. See the <a href=http://www.python.org>Python</a> site for instructions.

<p> To determine if threading is enabled, start the Python interpreter from the command line and enter <code>import thread</code>. If you don't get an exception, all is well.


<a name=WebwareVersion><h2>Webware Version</h2></a>

<p> Unless you just downloaded Webware (and therefore WebKit), you should check to see if you have the latest version. This version you are looking at is 0.6.1. You can check for the latest version at <a href=http://webware.sourceforge.net>http://webware.sourceforge.net</a>.

<p> If you're feeling adventurous, you can get the latest in-development source code from the public repository. Instructions are located at the <a href=https://sourceforge.net/cvs/?group_id=4866>Webware CVS page</a>. You can find more information about CVS in general at <a href=http://www.cvshome.org>http://www.cvshome.org</a>.


<a name=InstallingWebware><h2>Installing Webware</h2></a>

<p> Webware's main directory contains an <b>install.py</b> script that should always be run first.

<p> Note that the install program doesn't actually copy the Webware files to any separate directory. It copies files within the Webware directory tree, modifies permissions, generates documentation, etc.

<p> Also, you can run the install program as many times as you like with no ill effect, so if you're not sure whether or not it has been run, feel free to do so again. If you're debugging a problem, you can run <b>install.py -v</b> for verbose output.


<a name=OpSys><h2>Operating Systems</h2></a>

<p> WebKit actively supports UNIX, Windows (95/98/NT/2000) and their various flavors.

<p> Note that you don't have to develop and deploy on the same platform. One of the WebKit developers develops everything on Windows 98 2nd edition and deploys his web sites on BSD (<a href=http://www.bsd.org/>http://www.bsd.org/</a>).

<p> What follows are some OS specific notes:

<p> [UNIX] Nothing special to report. Both Linux and BSD have been used with WebKit.

<p> [WinNT] If you are using IIS as your web server, please see the <a href=#WebServers_IIS>IIS notes</a> below.

<p> [Win9x] Although a lot of the development of both WebKit and various web sites that use it has been done on Windows 9x, we don't recommend that you use this operating system to actually serve your users. UNIX and NT are generally more robust and secure and therefore, more appropriate for deployment.

<p> [Win] Some Windows users are surprised that URLs passed to WebKit are case sensitive. While it's true that the various Windows file systems are case insensitive, the data structures that WebKit uses internally are not. This is on the to do list.

<p> [Win] When editing path names in configuration files, keep in mind that you are editing a Python dictionary populated with Python strings. Therefore your paths must either use double backslashes (\\) (since the backslash is a special character), use forward slashes or use "r-strings". A bad example is <code>'C:\All\Web\'</code>. Good examples include:

<ul>
	<li> <code>'/All/Web'</code>
	<li> <code>'C:/All/Web'</code>
	<li> <code>'C:\\All\\Web'</code>
	<li> <code>r'C:\All\Web'</code>
</ul>


<a name=WebServers><h2>Web Servers</h2></a>

<p> WebKit has been tested with both Apache and IIS, so chances are your web server has already been tested. For the most part, WebKit doesn't care what web server you use. The least common denominator is standard CGI, so as long as your web server supports that, you should be fine.

<a name=WebServers_Apache><h3>Apache</h3></a>

<p> Apache is the world's most popular web server, which means it's also well tested. The Apache home page is located at <a href=http://www.apache.org>http://www.apache.org</a>.

<p> In the simplest case, you can use WebKit CGI adapters with Apache.  For better performance, other apache adapters are the new <a href=#Adapters_mod_webkit>mod_webkit adapter</a>, the <a href=#Adapters_FastCGI>FastCGI adapter</a>, <a href=#Adapters_mod_python>mod_python adapter</a>, or the <a href=#Adapters_mod_snake>mod_snake adapter</a>


<a name=WebServers_IIS><h3>IIS</h3></a>

<p> Microsoft's Internet Information Server, or IIS, requires some special configuration due to its default non-standard CGI behavior. You have to do two things:

<p> 1) For IIS 4.0, configure it to handle PATH_INFO and PATH_TRANSLATED according to the CGI specification, by running the following command:

<p> <code>cscript adsutil.vbs SET W3SVC/1/AllowPathInfoForScriptMappings 1</code>

<p> This is lightly documented in
<a href=http://support.microsoft.com/support/kb/articles/Q184/3/20.ASP>http://support.microsoft.com/support/kb/articles/Q184/3/20.ASP</a>.

<p> 2) Use Gordon McMillan's Standalone utility, which is part of his Installer package, to convert WebKit.cgi into an executable program, WebKit.exe.  IIS apparently will not handle requests with additional path components after the name of the script, like <code>http://localhost/WebKit.cgi/foo/bar</code> where WebKit.cgi is a script, but will handle requests like <code>http://localhost/WebKit.exe/foo/bar</code> where WebKit.exe is an executable. In any case, using the Standalone utility probably results in a speed increase, so this is probably a good thing to do anyway.

<p> In order to convert WebKit.cgi into WebKit.exe using the Standalone utility, you first have to rename it to WebKit.py, and add <code>import socket</code> to the top of the file (you could use a configuration file instead, but this is easier). After creating the .exe file, delete WebKit.pyc and rename WebKit.py to _WebKit.py. This will avoid conflicts with the .exe.

<p> We hope to provide a native Windows executable cgi program written in C in the near future, as well as a DLL for apache and an ISAPI module for IIS.  If you would like to implement any of these, please do so.  The mod_webkit adapter source includes all of the WebKit specific code you'll need.


<a name=WebServers_AOLserver><h3>AOLserver</h3></a>

<p> The PyWX project aims to meld Python and AOLserver and as part of that, they created an AOLserver "stay resident" WebKit adapter for tighter integration. More information can be found at <a href=http://pywx.idyll.org>http://pywx.idyll.org</a>.  If you find that this adapter does not work with the latest release of Webware, please notify the PyWX project.


<a name=Architecture><h2>Architecture</h2></a>

<p> The WebKit architecture involves three main entities at the top level:

<ol>
	<li> The web browser
	<li> The web server
	<li> The app server
</ol>

<p> The browser will be something like Microsoft Internet Explorer or Netscape Communicator. The web server will be something like Apache or IIS. And finally, the app server will be WebKit, e.g. a Python process running the WebKit modules and your custom servlets.

<p> The chronological order of events goes from top to bottom and then back up to top. In other words, the browser makes a request to the web server which in turn makes a request to the app server. The response then goes from the app server to the web server to the browser.

<p> The key to installing WebKit is to get the web server and app server talking to each other. For this purpose, you must use a WebKit adapter. See below.


<a name=BadMarshalData><h2>Bad Marshal Data</h2></a>

<p> The most common installation problem is a Python exception appearing in your browser that says "bad marshal data". This is always caused by pointing the web browser to the app server:

	<blockquote>http://localhost:8086/WebKit.cgi/</blockquote>

<p> But the app server hides behind a web server so the correct URL would be:

	<blockquote>http://localhost/WebKit.cgi/</blockquote>

<p> That requires that web server and app server are set up to talk to each other. And that's what the next section is all about...


<a name=Adapters><h2>Adapters</h2></a>

<p> A WebKit adapter takes an HTTP request from a web server and, as quickly as possible, packs it up and ships it to the app server which subsequently sends the response back to the adapter for delivery to the web server and ultimately the web client. More concisely, an adapter is the go-between of the web server and the app server.

<p> The current suite of adapters for WebKit are:

<ol>
	<li> CGI
	<li> FastCGI
	<li> OneShot
	<li> mod_python
	<li> mod_snake
	<li> AOLserver
	<li> mod_webkit
</ol>


<a name=Adapters_Permissions><h3>Permissions</h3></a>

<p> Note that on UNIX and NT, regardless of which adapter you use, you may need to set some permissions so that the app server can write files to the WebKit directories Cache, ErrorMsgs, Logs and Sessions.

<p> The easiest way to do this is to make these directories writeable by all (on UNIX, that would be <code>cd Webware/WebKit; chmod -R a+rwX Cache ErrorMsgs Logs Sessions</code>).

<p> The most secure way to do this, is to make sure the app server and its adapter are executed by a specific user and that the specific user has write permissions to these directories (but no one else). This requires some savvy with both your operating system and your web server. You may wish to take the easy approach first in order to bootstrap yourself and then come back to this.


<a name=Adapters_CGI><h3>CGI Adapter</h3></a>

<p> The "classic" WebKit setup uses the CGI adapter, known as WebKit.cgi. Almost all web servers support CGI so it was obvious that WebKit should, too.

<p> In this configuration, the app server stays resident (similar to the web server) and is tapped for responses by a small CGI program that forwards the request to the app server.

<p> Note that even though this approach uses CGI, such a WebKit application will run faster than the equivalent all-CGI solution. The reason is that that the app server (and possibly your servlets) can do quite a bit of caching, and the CGI adapter is fairly small. On the other hand, this is one of the slower adapters out of the bunch.

<p> To set this up, do the following:


<h4>1. Review and fix permissions</h4>
<ul>
	<li> This was described earlier in <a href=#Adapters_Permissions>Permissions</a>.
</ul>

<h4>2. Set up WebKit.cgi</h4>
<ul>
	<li> Copy WebKit/WebKit.cgi to a location where your web server has CGI execute permissions.
	<li> [IIS] See the <a href=#WebServers_IIS>IIS configuration notes</a> above.
	<li> [Windows and Apache] With a text editor, modify the first line of WebKit.cgi to read <code>#!python</code> rather than <code>#!/usr/bin/env python</code>. Make sure that python is in your search path as defined in AUTOEXEC.BAT. You can check this by typing <code>python</code> at the command prompt to see if Python launches.
	<li> [UNIX] On most UNIX systems, the WebKit.cgi startup line, <code>#!/usr/bin/env python</code>, works just fine. You can check this by typing <code>/usr/bin/env python</code> at the command line to verify that Python launches. In the event that it does not, or if you wish to point to a different installation, you can change the line to something else, for example, <code>/usr/local/bin/python</code> or <code>/home/me/bin/python</code>.
	<li> Using a text editor, change the line in WebKit.cgi that reads <code>WebwareDir = None</code> to point to Webware. For example, <code>WebwareDir = '/home/me/Webware'</code>.
</ul>

<h4>3. Launch the servers</h4>
<ul>
	<li> Verify that your web server is running and launch it if not.
	<li> At the command line, change directories to the WebKit directory, for example, <code>cd ~/Webware/WebKit</code> on UNIX and <code>cd \Webware\WebKit</code> on Windows).
	<li> Still at the command line, type <code>AppServer</code> and press return. You should see the startup messages for the app server. This works on both Windows and UNIX, via the <code>AppServer.bat</code> and <code>AppServer</code> startup scripts. You will see that they are very simple scripts and simply point to the recommended default app server.
</ul>


<h4>4. Try it out</h4>
<ul>
	<li> At this point, you should have fixed permissions, set up WebKit.cgi and launched the servers.
	<li> You can now try a URL such as <code>http://localhost/WebKit.cgi/</code>. By default, the WebKit app server will display the Examples page. A sidebar provides navigation of the various examples which you can look through. Note that for any example, you can view its source code by clicking the <b>View source of...</b> link in the sidebar.
	<li> Some diagnostic information will be printed in the terminal window of the server. You'll notice after the first page is served, that additional pages are served much faster. You can verify this in the console of the app server which reports the response time for each request. As the application warms up (e.g., caches classes, objects, files and settings) performance increases.
	<li> You will also notice a list of "contexts" in the sidebar. Each context has its own directory and to create your own web applications, you will create a new context, perhaps even setting it to be the default. See <a href=#Contexts>Contexts</a> below.
	<li> One context you should look at now is <b>Admin</b>. These pages let you view the WebKit logs, configuration, installed plug-ins, etc.
</ul>


<a name=Adapters_Stopping><h3>Stopping the App Server</h3></a>

<p> The recommended method of stopping the AppServer is through the Application Control interface.  This is a servlet located in the Admin context.  A username and password are required, and these default to "admin" and "webware".  (If your system is open to the internet, please change the password immediately.  It's set in the WebKit/Configs/Application.config file).  This shutdown method is safer than doing a ctrl-c from a terminal, as described below.

<p> On all OSs, stopping the app server may also be accomplished by simply going to its terminal/command window and hitting Control-C. The app server is designed to intercept this interruption and shut down as gracefully as possible. This includes saving session data to disk, if necessary.

<p> On UNIX, a running appserver may be stopped from a terminal by typing "AppServer stop".

<p> [Windows] Control-C normally shuts the app server down <i>gracefully</i>, where as Control-Break does not. Keep that in mind and use Control-C, unless the server is unresponsive to it.

<p> [UNIX] If you don't have access to the terminal window of the app server (perhaps because you used rlogin, telnet or ssh to remotely access the machine), and "AppServer stop" doesn't work, you can use <code>ps -ax | grep AppServer</code> to get the pid and <code>kill &lt;pid&gt;</code> to effect a Control-C.


<a name=Adapters_Reloading><h3>Reloading Servlets</h3></a>

<p> As you develop your web application, you will change the code of your various Python classes, including your servlets. The WebKit app server will detect a change in the timestamp of a servlet's source file and automatically reload it for you.

<p> However, reloading fails in two areas. The first is that WebKit doesn't check ancestor classes of servlets for modifications. So if you modify an abstract class (for example, SitePage, AccountPage, etc.), it won't be reloaded. The second is that WebKit can't check non-servlet classes. So if you modify a utility class (for example, ShoppingCart, Story, etc.), it won't be reloaded.

<p> You can deal with reloading problems by stopping the app server (Control-C in its terminal/command window) and restarting it. If this gets too bothersome during development (and it probably will), use the OneShot adapter.

<p> A new alternative way of reloading ancestor classes is through the Application Control servlet, in the Admin context, which will provide a list of all of the currently loaded modules, and allow you to reload selected modules.


<a name=Adapters_OneShot><h3>OneShot Adapter</h3></a>

<p> The OneShot adapter is another CGI based adapter, but unlike WebKit.cgi, the app server launches, serves a response and shuts down for every single request via OneShot.cgi.

<p> There are three major reasons to use the OneShot adapter:

<dl>
	<p><dt>1. When developing a web site. </dt>
	<dd> OneShot avoids the reloading problems described in the previous section, because the app server is loaded fresh for every request. </dd>

	<p><dt>2. When developing WebKit itself and/or plug-ins. </dt>
	<dd> Restarting the app server is required in these circumstances, so again, OneShot becomes a convenient way to do this. </dd>

	<p><dt>3. To ensure absolute stability. </dt>
	<dd> Stability problems and memory leaks are unlikely to occur with OneShot since the lifetime of the app server is so short. However, the persistent app server is fairly well tested so this particular reason is somewhat weak. </dd>
</dl>

<p> Of course, the cost of these benefits is performance. OneShot is at least an order of magnitude slower than a persistent app server. For development, that's not a problem. But for a deployed site with multiple users it could be.

<p> We generally recommend that you develop with OneShot and deploy with something else, like <a href=#Adapters_CGI>WebKit.cgi</a> or <a href=#Adapters_FastCGI>FastCGI</a> (see below).

<p> To set up OneShot, follow the same instructions as for WebKit.cgi with two exceptions and one addition:

<ol>
	<li> Work with OneShot.cgi (not WebKit.cgi).
	<li> Do not launch the app server (OneShot will not use it even if it's loaded).
</ol>


<a name=Adapters_FastCGI><h3>FastCGI Adapter</h3></a>

<p> The essence of the FastCGI protocol is to keep the CGI program resident. In our case, that program is a combination of the Python interpreter, several standard Python modules and the WebKit adapter code. By eliminating the constant reloading of these components, a substantial speedup can be obtained (2 X in informal tests).

<p> Your web server will have to be FastCGI enabled, which you may be able to accomplish by downloading software at <a href=http://www.FastCGI.com>http://www.FastCGI.com</a> where you can also learn more about FastCGI.

<p> The top of FCGIAdapter.py contains a doc string explaining its setup.

<p> Note that to date, we have only gotten this to work on UNIX.

<p> For development purposes, the FastCGI adapter doesn't offer anything substantial. However, for deploying your site for real use, the extra configuration effort could be well worth the performance boost.

<p> Another adapter that provides the same type of benefit is the <a href=#Adapters_mod_python>mod_python adapter</a>, described below.


<a name=Adapters_mod_python><h3>Mod_python Adapter</h3></a>

<p> Mod_python is a module that embeds the Python interpreter into the Apache web server. This can make for a substantial speedup over WebKit.cgi which reloads the Python interpreter and various modules for each request.

<p> mod_python itself and the adapter are both somewhat new, which makes this approach the least tested among the bunch.

<p> The top of ModPythonAdapter.py contains a doc sting explaining the setup.

<p> This has been tested on both UNIX and Windows.  On Windows, you should use mod_python 2.7.4 or later because there is a bug in earlier versions of mod_python for Windows that can cause Apache to crash or return incorrect responses under heavy load.

<p> More information about mod_python can be found at <a href=http://www.modpython.org>http://www.modpython.org</a>.

<p> Another adapter that provides the same type of benefit is the <a href=#Adapters_FastCGI>FastCGI adapter</a> described above.


<a name=Adapters_mod_snake><h3>ModSnake Adapter</h3></a>

<p> This adapter is similar to ModPython, but written for the mod_snake apache module.  mod_snake is another method of embedding a python interpreter into apache.  mod_snake may be preferable over mod_python if you need to work with Apache 2.0, or if you would like greater access to the internals of Apache than is available through mod_python.

<p> A doc string is included at the top of ModSnakeAdapter.py which describes the configuration steps to use this adapter.

<a name=Adapters_mod_webkit><h3>ModWebkit Adapter</h3></a>

<p> This is a native apache module designed solely to communicate with WebKit.  It is written in C, and has been tested on Linux and Windows.

<p> This adapter is the fastest of the adapters available for WebKit.

<p> The source code and a README file describing how to configure and build mod_webkit are located in the Webware/WebKit/Native/mod_webkit directory.

<a name=Adapters_AOLserver><h3>AOLserver Adapter</h3></a>

<p> This adapter comes with the Python-enhanced AOLserver created by the <a href=http://pywx.idyll.org>PyWX project</a> and is described there.


<a name=Adapters_Renaming><h3>Renaming Adapters</h3></a>

<p> Adapters such as WebKit.cgi and OneShot.cgi do not rely on their name. Consequently, when you deploy your web site, you can rename the adapter to something like <code>serve.cgi</code>. This allows you to switch adapters later without affecting the URLs and therefore the bookmarks of your users (provided you're still using some form of CGI adapter).

<a name=Adapters_Problems><h3>Adapter Problems</h3></a>

<p> There is one gotcha in setting up the adapters that don't rely on CGI.  For mod_webkit, ModPython and ModSnake, the name that you give to the adapter location in your Apache configuration file must not actually exist in your apache document root.  Also, you may not have a file or directory in your document root with the same name as one of WebKit's contexts.  So, you can't have a directory named Examples in your document root.

<a name=Configuration><h2>Configuration</h2></a>

<p> In this section, we'll briefly touch on some of the configuration options related to installing and running WebKit. A full reference to these options can be found in the User's Guide under <a href=UsersGuide.html#Configuration>Configuration</a>.

<p> The settings referenced below are found in the configuration file, Configs/Application.config.


<a name=Configuration_Sessions><h3>Sessions</h3></a>

<p> WebKit provides a Session utility class for storing data on the server side that relates to an individual user's session with your site. The <code>SessionStore</code> setting determines where the data is stored and can currently be set to <code>Dynamic</code> or <code>File</code>.

<p> Storing to the Dynamic session store is the fastest solution and is the default. This session storage method keeps the most recently used sessions in memory, and moves older sessions to disk periodocally. All sessions will be moved to disk when the server is stopped.  This storage mechanism works with both the persistant, long running AppServers and OneShot.  There are two settings in Application.config relating to this Session store.  <code>MaxDynamicMemorySessions</code> specifies the maximum number of sessions that can be in memory at any one time.   <code>DynamicSessionTimeout</code> specifies after what period of time sessions will be moved from memory to file. ( Note:  this setting is unrealted to the <code>SessionTimeout</code> setting below.  Sessions which are moved to disk by the Dynamic Session store are not deleted).

<p> Storing to files is provided mainly in support of the OneShot adapter. It may also prove useful in the future in support of load balancing. In this scenario, each individual session is stored in its own file, loaded for every request and saved when delivering the corresponding response.

<p> All on-disk session information is located in WebKit/Sessions.

<p> Also, the <code>SessionTimeout</code> setting lets you set the number of minutes of inactivity before a user's session becomes invalid and is deleted. The default is 60.  The Session Timeout value can also be changed dynamically on a per session basis.


<a name=Configuration_ActivityLog><h3>Activity Log</h3></a>

<p> Three options let you control:

<ul>
	<li> Whether or not to log activity (LogActivity, defaults to 0, or off)
	<li> The name of the file to store the log (ActivityLogFilename, defaults to 'Logs/Activity.csv')
	<li> The fields to store in the log (ActivityLogColumns)
</ul>

<p> See <a href=UsersGuide.html#Configuration>Configuration</a> in the User's Guide for more information.


<a name=Configuration_EmailErrors><h3>E-mail Errors</h3></a>

<p> <code>EmailErrors</code>, <code>ErrorEmailServer</code> and <code>ErrorEmailHeaders</code> let you configure the app server so that uncaught exceptions land in your mailbox in real time. You should definitely set these options when deploying a web site.

<p> See <a href=UsersGuide.html#Configuration>Configuration</a> in the User's Guide for more information.


<a name=Contexts><h2>Contexts</h2></a>

<p> WebKit divides the world into <i>contexts</i>, each of which is a directory with its own files and servlets. WebKit will only serve files out of its list of known contexts.

<p> Some of the contexts you will find out of the box are Examples, Documentation and Admin. When viewing either an example or admin page, you will see a sidebar that links to all the contexts.

<p> Another way to look at contexts is a means for "directory partitioning". If you have two distinct web applications (for example, PythonTutor and DayTrader), you will likely put each of these in their own context.

<p> To add a new context, simply add a new one to the <code>Contexts</code> dictionary of Application.config. The key is the name of the context as it appears in the URL and the value is the path (absolute or relative to the WebKit directory). Often the name of the context and the name of the directory will be the same:

<p> <code>'DayTrader': '/All/Web/Apps/DayTrader',</code>

<p> The URL to access DayTrader would then be something like:

<p> <code>http://localhost/WebKit.cgi/DayTrader/</code>

<p> The special name <code>default</code> is reserved to specify what context is served when none is specified (as in <code>http://localhost/WebKit.cgi/</code>). Upon installation, this is the Examples context, which is convenient during development since it provides links to all the other contexts.

<p> Note that a context can contain an <code>__init__.py</code> which will be executed when the context is loaded at app server startup. You can put any kind of initialization code you deem appropriate there.


<a name=AppServerNotes><h2>AppServer Notes</h2></a>

<a name=AppServerNotes_Threaded><h3>ThreadedAppServer</h3></a>

<p>WebKit uses a process called an AppServer to handle requests.  The AppServer is responsible for receiving a request from the adapter, and then running it through the Application, and then sending the response back to the adapter.  The default AppServer is called ThreadedAppServer.  This AppServer uses a set number of threads to process requests.  The number of threads used is configurable.  As each request comes in, a thread from the thread pool will be handed that request and will be responsible for receiving the request from the adapter, running the request through the Application, and then sending the response back to the adapter.

<!--
<a name=AppServerNotes_Async><h3>AsyncThreadedAppServer</h3></a>

<p>There is also a modified version of ThreadedAppServer, called AsyncThreadedAppServer. The modification is that the threads are only responsible for running a request through the Application and not for any network I/O which is handled by the Python asyncore module.  The reason for this alternate form is that heavy network traffic could theoretically tie up threads if they are responsible for sending the response, thus leaving the potential for the AppServer to run out of threads to process requests.

<p> [Linux] In testing on Linux systems, AsyncThreadedAppServer has shown a slight drop in performance for light loads, but has held up better than the threaded version under very heavy loads.

<p> [WinNT] On Windows NT, testers have reported little difference between the two AppServers under heavy loads, and a slight slowdown when using the Async version under light loads.

<p> [Win98] On Windows 98, this version of the app server has major problems simply serving a handful of simultaneous requests, so stick with the default threaded version.

<p> You can change which AppServer is used by editing the file AppServer (on UNIX) or AppServer.bat (on Windows).


<a name=AppServerNotes_AsyncHTTP><h3>AsyncThreadedHTTPServer</h3></a>

<p>There is an experimental web server called AsyncThreadedHTTPServer which serves HTTP requests directly from the web browser without needing a separate web server and adapter.  We do not currently recommend AsyncThreadedHTTPServer for deployment because it is brand new and hasn't undergone rigorous testing.  But please feel free to experiment with it, and report any problems found to the Webware developers.

<p>AsyncThreadedHTTPServer listens to requests directly from the web browser on the port specified in AppServer.config.  This defaults to port 8086, so you would connect to AsyncThreadedHTTPServer using a url such as <code>http://localhost:8086/</code>.  If you want it to listen to the standard web server port, you can edit AppServer.config to change the port from 8086 to 80.

<p>AsyncThreadedHTTPServer can in theory be used with Apache acting as a proxy, but this has not yet been tested.

<a name=AppServerNotes_Monitoring><h3>Monitoring</h3></a>

<p> [UNIX] In order to provide additional stability and peace of mind, a monitor process has been developed.  The monitor is responsible for starting the AppServer and monitoring its health.  If it detects that the AppServer is not responding, it will start a new AppServer and clean up the old one.  In order to use the monitor, run the file Monitor.py with the argument start or stop. Optionally, you can also specify "daemon" on the command line to run the process as a daemon. The Monitor process will handle the starting of the main AppServer. In order to shut down WebKit when using the monitor process, run Monitor.py with "stop" as an argument.

<p> This process will be available on Windows systems in the near future.
-->


<a name=AppServerNotes_UNIXStartUp><h3>Launching the AppServer at UNIX boot up</h3></a>

<p> The script <span class=filename>WebKit/webkit</span> is a UNIX shell script launching WebKit at boot time through the standard "init" mechanisms.

<p> To start WebKit at boot time, make the necessary variable modifications in the script, like so:

<p> <table class=cmd><tr><td>
WEBKIT_DIR=/opt/Webware/WebKit<br>
PID_FILE=$WEBKIT_DIR/appserverpid.txt<br>
LOG=/var/log/webkit<br>
PYTHONPATH=<br>
PYTHONPATH_ADDONS=
</td></tr></table>

<p> Now put this script in <span class=filename>/etc/rc.d/init.d</span> and do this:

<p> <table class=cmd><tr><td>
&gt; <span class=typed>cd /etc/rc.d/init.d</span> <br>
&gt; <span class=typed>chmod a+rx webkit</span> <br>
&gt; <span class=typed>chkconfig webkit reset</span>
</td></tr></table>

<p> That takes care of getting it started for future boots, but this first time you need to jump start it:

<p> <table class=cmd><tr><td>
&gt; <span class=typed>./webkit start</span> <br>
</td></tr></table>


<h4>Additional Notes</h4>

<p> You can use chkconfig to put this in at the right runlevels. By default, it is set up properly for the default Apache install, which is to say that the AppServer starts up before Apache and shuts down after Apache.

<p> By default, the script is in runlevels 2-5 at start priority 75, stop priority 25.

<p> You will notice the variables <span class=name>PYTHONPATH</span> and <span class=name>PYTHON_PATH</span> which are both set to blank. The first prevents inheriting PYTHON_PATH from the environment (as security paranoia). You can comment this out if you prefer to inherit the Python path. The second allows you specify additional Python path components (regardless of whether or not you inherited the path).


<a name=AppServerNotes_NTService><h3>Running ThreadedAppServer as a Windows NT/2000 Service</h3></a>

<p>ThreadedAppServerService is a version of ThreadedAppServer that runs as
a Windows NT Service.  This means it can be started and stopped from
the Control Panel or from the command line using "net start" and
"net stop", and it can be configured in the Control Panel to
auto-start when the machine boots.  This is the preferred way to deploy WebKit on a Windows NT/2000 platform.

<p>ThreadedAppServerService requires the Python win32all extensions to have been installed.

<p>To see the options for installing, removing, starting, and stopping
the service, just run ThreadedAppServerService.py with no arguments.  Typical usage is
to install the service to run under a particular user account and startup
automatically on reboot with

<p><code>python ThreadedAppServerService.py --username mydomain\myusername --password mypassword --startup auto install</code>

<p>Then, you can start the service from the Services applet in the Control Panel,
where it will be listed as "WebKit Threaded Application Server".  Or, from
the command line, it can be started with either of the following commands:

<p><code>net start WebKit
<br>python ThreadedAppServerService.py start</code>

<p>The service can be stopped from the Control Panel or with:

<p><code>net stop WebKit
<br>python ThreadedAppServerService.py stop</code>

<p>And finally, to uninstall the service, stop it and then run:

<p><code>python ThreadedAppServerService.py remove</code>


<a name=AppServerNotes_Other><h3>Other Notes</h3></a>

<p> See <a href=#Adapters_Stopping>Stopping the App Server</a> and <a href=#Adapters_Reloading>Reloading Servlets</a> above in <a href=#Adapters>Adapters</a>.


<a name=Future><h2>Future</h2></a>

<p> This section documents future items for this install guide. To learn about future developments for WebKit, see WebKit's <a href=Future.html>Future</a> document.

<ul>
	<li> A verbatim actual install on a box such as BSD.
	<li> Notes on third party web host providers.
	<li> Some example web pages of the startup screen, examples page, admin page, etc.
</ul>



<a name=Credit><h2>Credit</h2></a>

<p> Chuck Esterbrook (primary author)
<br>Geoff Talvola (IIS notes)
<br>Jay Love (AppServer notes)

<!-- Not true, yet.  :-)   <p> Several people, mostly on the webware-discuss mailing list, have provided feedback and testing of this guide. -->


<p><hr>

</body>
</html>
