<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.2.8: http://docutils.sourceforge.net/" />
<title>Beginner Tutorial</title>
<link rel="stylesheet" href="default.css" type="text/css" />
</head>
<body>
<div class="document" id="beginner-tutorial">
<h1 class="title">Beginner Tutorial</h1>
<p>Version 0.7, Webware for Python 0.7</p>
<div class="contents topic" id="contents">
<p class="topic-title"><a name="contents">Contents</a></p>
<ul class="simple">
<li><a class="reference" href="#synopsis" id="id1" name="id1">Synopsis</a></li>
<li><a class="reference" href="#installation" id="id2" name="id2">Installation</a></li>
<li><a class="reference" href="#setting-up-your-environment" id="id3" name="id3">Setting Up Your Environment</a><ul>
<li><a class="reference" href="#creating-a-working-directory" id="id4" name="id4">Creating a Working Directory</a></li>
<li><a class="reference" href="#changing-webware-configuration" id="id5" name="id5">Changing Webware Configuration</a></li>
</ul>
</li>
<li><a class="reference" href="#creating-and-understanding-the-servlet" id="id6" name="id6">Creating and Understanding the Servlet</a></li>
<li><a class="reference" href="#a-brief-introduction-to-the-servlet" id="id7" name="id7">A Brief Introduction to the Servlet</a></li>
</ul>
</div>
<div class="section" id="synopsis">
<h1><a class="toc-backref" href="#id1" name="synopsis">Synopsis</a></h1>
<p>We present a tutorial on making a Webware script, and some guidance on turning that into a web application.</p>
</div>
<div class="section" id="installation">
<h1><a class="toc-backref" href="#id2" name="installation">Installation</a></h1>
<p>This document does not cover the basic installation.  See the <a class="reference" href="InstallGuide.html">Install Guide</a>
-- you should be able to open up the Examples context in Webware before you continue.</p>
</div>
<div class="section" id="setting-up-your-environment">
<h1><a class="toc-backref" href="#id3" name="setting-up-your-environment">Setting Up Your Environment</a></h1>
<div class="section" id="creating-a-working-directory">
<h2><a class="toc-backref" href="#id4" name="creating-a-working-directory">Creating a Working Directory</a></h2>
<p>We'll first set up a directory dedicated to your application.  Run this command:</p>
<pre class="literal-block">
$ cd ~
$ python /path/to/Webware/bin/MakeAppWorkDir.py -l --cvsignore \
  -c context WebwareTest
</pre>
<p>You'll now have a directory WebwareTest in your home directory (or of course you can put it in some other location).  Inside this directory will be several subdirectories and a couple files.  The only file we'll worry about is <tt class="literal"><span class="pre">AppServer</span></tt> (or <tt class="literal"><span class="pre">AppServer.bat</span></tt> if you're on Windows).  The directories of interest are <tt class="literal"><span class="pre">context</span></tt> (that you specified with <tt class="literal"><span class="pre">-c</span> <span class="pre">context</span></tt>) where you'll be putting your servlets; <tt class="literal"><span class="pre">Configs</span></tt> that holds some configuration files; and <tt class="literal"><span class="pre">lib</span></tt> where you can put your non-servlet code.</p>
<p>For more information about the working directory and setting up the file structure for your application, see <a class="reference" href="ApplicationDevelopment.html">Application Development</a>.</p>
</div>
<div class="section" id="changing-webware-configuration">
<h2><a class="toc-backref" href="#id5" name="changing-webware-configuration">Changing Webware Configuration</a></h2>
<p>For the most part the configuration is fine, but we'll make a couple changes to make it easier to develop.  For more information on configuration see the <a class="reference" href="Configuration.html">Configuration Guide</a>.</p>
<p>In the file <tt class="literal"><span class="pre">AppServer.config</span></tt>, change this line:</p>
<pre class="literal-block">
# Original (default setting):
    'AutoReload': 0,
# To:
    'AutoReload': 1,
</pre>
<p>This will cause the AppServer to restart if any loaded files are changed -- without this you may edit a file and your application won't see the updated version until you manually restart the AppServer.</p>
<p>The other change you may want to make to allow you to use more interesting URLs.  In Application.config:</p>
<pre class="literal-block">
# Original (default setting):
    'ExtraPathInfo': 0,
# To:
    'ExtraPathInfo': 1,
</pre>
<p>Otherwise the settings should be appropriate for development.  (There are several you would want to change before deploying the application in a production environment).</p>
</div>
</div>
<div class="section" id="creating-and-understanding-the-servlet">
<h1><a class="toc-backref" href="#id6" name="creating-and-understanding-the-servlet">Creating and Understanding the Servlet</a></h1>
<p>Webware's core concept for serving pages is the <em>servlet</em>.  This is a class that creates a response given a request.</p>
<p>The core classes to understanding the servlet are <tt class="literal"><span class="pre">Servlet</span></tt>, <tt class="literal"><span class="pre">HTTPServlet</span></tt>, and <tt class="literal"><span class="pre">Page</span></tt>.  Also of interest would be the request (<tt class="literal"><span class="pre">Request</span></tt> and <tt class="literal"><span class="pre">HTTPRequest</span></tt>) and the response (<tt class="literal"><span class="pre">Response</span></tt> and <tt class="literal"><span class="pre">HTTPResponse</span></tt>) -- the <tt class="literal"><span class="pre">HTTP-</span></tt> versions of these classes are more interesting.  There is also a <tt class="literal"><span class="pre">Transaction</span></tt> object, which is solely a container for the request and response.</p>
<p>While there are several levels you can work on while creating your servlet, in this tutorial we will work solely with subclassing the <tt class="literal"><span class="pre">Page</span></tt> class.  This class defines a more high-level interface, appropriate for generating HTML (though it can be used with any content type).  It also provides a number of convenience methods.</p>
</div>
<div class="section" id="a-brief-introduction-to-the-servlet">
<h1><a class="toc-backref" href="#id7" name="a-brief-introduction-to-the-servlet">A Brief Introduction to the Servlet</a></h1>
<p>Each servlet is a plain Python class.  There is no Webware magic (except perhaps for the level one <em>import module based on URL</em> spell).  PSP has more magic, but that's a topic for another day. (&#64;&#64; ib: link to PSP doc)  An extremely simple servlet might look like:</p>
<pre class="literal-block">
from WebKit.Page import Page

class MyServlet(Page):

    def title(self):
        return 'My Sample Servlet'
        
    def writeContent(self):
        self.write('Hello world!')
</pre>
<p>This would be placed in <tt class="literal"><span class="pre">MyServlet.py</span></tt>.  Webware will create a pool of <tt class="literal"><span class="pre">MyServlet</span></tt> instances, which will be reused.  Servlets &quot;write&quot; the text of the response (like <tt class="literal"><span class="pre">self.write(&quot;some</span> <span class="pre">text&quot;)</span></tt>).  Webware calls the servlet like this:</p>
<ul class="simple">
<li>An unused servlet is taken from the pool, or another servlet is created.</li>
<li><tt class="literal"><span class="pre">awake(transaction)</span></tt> is called.  This is a good place to set up data
for your servlet.  You can put information in instance variables for use later
on.  But be warned -- those instance variables will hang around potentially
for a long time if you don't delete them later (in <tt class="literal"><span class="pre">sleep</span></tt>).</li>
<li>Several low-level methods are called, which Page isolates you from.  We will
ignore these.</li>
<li><tt class="literal"><span class="pre">writeHTML()</span></tt> is called.  <tt class="literal"><span class="pre">Page</span></tt> implements this just fine, but you
can override it if you want total control, or if you want to output something
other than HTML.</li>
<li><tt class="literal"><span class="pre">writeDocType()</span></tt> would write something like <tt class="literal"><span class="pre">&lt;!DOCTYPE</span> <span class="pre">HTML</span> <span class="pre">PUBLIC</span> 
<span class="pre">&quot;-//W3C//DTD</span> <span class="pre">HTML</span> <span class="pre">4.01</span> <span class="pre">Transitional//EN&quot;</span>&nbsp;&nbsp; 
<span class="pre">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;</span></tt></li>
<li>The &lt;head&gt; section of the page is written.  <tt class="literal"><span class="pre">title()</span></tt> gives the title, and
you probably want to override it.</li>
<li><tt class="literal"><span class="pre">writeStyleSheet()</span></tt> is called, if you want to write that or anything else in
the &lt;head&gt; section.</li>
<li>The &lt;body&gt; tag is written.  Have <tt class="literal"><span class="pre">htBodyArgs()</span></tt> return anything you want in
the &lt;body&gt; tag (like <tt class="literal"><span class="pre">onLoad=&quot;loadImages()&quot;</span></tt>)</li>
<li><tt class="literal"><span class="pre">writeBodyParts()</span></tt> is called, which you may want to override if you want
to create a template for other servlets.</li>
<li><tt class="literal"><span class="pre">writeContent()</span></tt> should write the main content for the page.  This is where
you do most of your display work.</li>
<li>The response is packaged up, the headers put on the front, cookies handled,
and it's sent to the browser.  This is all done for you.</li>
<li><tt class="literal"><span class="pre">sleep(transaction)</span></tt> is called.  This is where you should clean up anything
you might have set up earlier -- open files, open database connections, etc.
Often it's empty.</li>
<li>The servlet is placed back into the pool, to be used again.  This only happens
after the transaction is complete -- the servlet won't get reused any earlier.</li>
</ul>
<p>You only have to override the portions that you want to.  It is not uncommon to only override the <tt class="literal"><span class="pre">writeContent()</span></tt> method in a servlet, for instance.</p>
<p>Each servlet is a class itself.  Behind the scenes Webware creates a pool of servlet instances for each servlet, and then reuses those servlets.</p>
<p>You will notice a servlet in your new context named <tt class="literal"><span class="pre">Main.py</span></tt>.  The Main (or index) servlet is like the <tt class="literal"><span class="pre">index.html</span></tt> file -- it is used if no servlet name is given.  Here's the contents of that file:</p>
<pre class="literal-block">
from WebKit.Page import Page

class Main(Page):

    def title(self):
        return 'My Sample Context'

    def writeContent(self):
                self.writeln('&lt;h1&gt;Welcome to Webware!&lt;/h1&gt;')
        self.writeln('''
        This is a sample context generated for you and has purposly been
        kept very simple to give you something to play with to get yourself
        started.  The code that implements this page is located in
        &lt;b&gt;%s&lt;/b&gt;.
        ''' % self.request().serverSidePath())

        self.writeln('''
        &lt;p&gt;
        There are more examples and documentaion in the Webware
        distribution, which you can get to from here:&lt;p&gt;&lt;ul&gt;
        ''')

        adapterName = self.request().adapterName()
        ctxs = self.application().contexts().keys()
        ctxs = filter(lambda ctx: ctx!='default', ctxs)
        ctxs.sort()
        for ctx in ctxs:
            self.writeln('&lt;li&gt;&lt;a href=&quot;%s/%s/&quot;&gt;%s&lt;/a&gt;' 
                         % (adapterName, ctx, ctx))

        self.writeln('&lt;/ul&gt;')
</pre>
</div>
</div>
</body>
</html>
